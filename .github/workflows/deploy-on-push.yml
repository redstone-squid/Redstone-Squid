name: Deployment
run-name: ${{ github.actor }} - ${{ github.event_name }} - ${{ github.sha }}
on:
  push:
    branches:
      - master
jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Pull latest changes
        run: |
          cd ~/Redstone-Squid
          git pull
      - name: Run python
        run: |
          cd ~/Redstone-Squid
          pkill -f "app.py" || true
          source ~/Redstone-Squid/venv/bin/activate
          pip-sync requirements.txt
          # The following is needed to run the app in the background
          # See: https://github.com/actions/runner/issues/598#issuecomment-1703807030
          RUNNER_TRACKING_ID="" && (nohup ~/Redstone-Squid/venv/bin/python3 app.py > app.log 2>&1 &)